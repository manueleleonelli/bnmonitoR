---
output: github_document
always_allow_html: true
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# bnmonitor

`bnmonitor` is a package for sensitivity analysis and robustness in Bayesian networks.

## Installation 

The package `bnmonitor` can be installed from GitHub using the command 
```{r eval = FALSE}
# install.packages("devtools")
devtools::install_github("manueleleonelli/bnmonitor")
```
and loaded in R with
```{r}
library(bnmonitor)
```
Note that `bnmonitor` requires the package `gRain` which, while on CRAN, depends on packages that are on Bioconductor both directly and through the `gRbase` package, which depends on `RBGL`:
```{r eval =F}
BiocManager::install()
BiocManager::install(c("graph", "Rgraphviz", "RBGL"))
install.packages("gRain")
```

## Overview

The prequential diagnostics examine the forecasts that flow from a model in sequence.
Each monitor given below indicates the probability of a particular observation based on the previous observations and the model structure. 
In the prequential mindset, we compute a probability of each subsequent observation based on all previous data points. 
These observations are then scored, and in this package we use the logarithmic score function.
The observations are then standardized to give a z-score statistic. 
Following the recommendation of Cowell (2007), scores indicate a poor fit where |z| > 1.96 

We demonstrate the efficacy of the prequential monitors with the Asia data set from the bnlearn package. Details of the variables (nodes) can be found in the documentation for bnlearn.

``` {r}
library(bnlearn)
data(asia)
summary(asia)
```

Lauritzen defines two candidate models we replicate below.
``` {r out.width="50%"}
asia_bn <- bnlearn::model2network("[A][S][T|A][L|S][B|S][D|B:E][E|T:L][X|E]")
bnlearn::graphviz.plot(asia_bn) 
asia_bn_alt <-  bnlearn::model2network("[A][S][T|A][L|S][B|S][E|T:L][X|E][D|B:E:S]")
bnlearn::graphviz.plot(asia_bn_alt) 
```

### Global monitor

The global monitor is equivalent to the Bayes Factor and offers a good assessment of the model as a whole. 
It is primarily useful for differentiating between candidate models as the global monitor pinpoints the nodes with different contributions for two candidate models.
We can assess the log likelihood contribution from each of the nodes and determine which nodes contribute the most to the global monitor.
global.monitor.graph provides a quick visual for the entire network. 
The darker the color, the more substantial the contribution of that node to the log likelihood.

The global monitor assesses the probability of observing the data given the model and as such does not particularly fit the prequential view. 
However, it is a quick and useful first diagnostic assessment.

``` {r}
glob1 <- global_monitor(asia_bn, asia, alpha = 3)
glob2 <- global_monitor(asia_bn_alt, asia, alpha = 3)
glob1
glob2
```

In the alternative model, Dysnopea contributes more to the log-likelihood. 

```{r}
plot(glob1)
```

